<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake: Levels Edition</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --panel-color: #2c3e50;
            --accent-color: #2ecc71;
            --text-color: #ecf0f1;
            --danger-color: #e74c3c;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none; /* Prevents highlighting text while playing */
        }

        /* Stats Bar (HUD) */
        .stats-bar {
            width: 600px;
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: var(--panel-color);
            border-radius: 8px 8px 0 0;
            font-size: 1.2rem;
            font-weight: bold;
            box-sizing: border-box;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
        }

        /* Game Container */
        #game-wrapper {
            position: relative;
            width: 600px;
            height: 400px;
            border: 4px solid var(--panel-color);
            border-top: none; /* Connects visually to stats bar */
            border-radius: 0 0 8px 8px;
            background: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        canvas {
            display: block;
            background-color: #000;
        }

        /* UI Overlays (Menus) */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 26, 26, 0.92); /* Dark semi-transparent background */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100; /* Ensures menu is always on top */
            transition: opacity 0.3s;
        }

        .hidden {
            display: none !important;
            opacity: 0;
            pointer-events: none;
        }

        h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(46, 204, 113, 0.3);
        }

        h2 { margin-bottom: 20px; font-size: 2rem; }

        /* Buttons */
        button {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 220px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        button:active { transform: translateY(0); }

        button.secondary { background: #7f8c8d; }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 10px;
        }

        .settings-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        input[type="color"] {
            border: none;
            width: 60px;
            height: 40px;
            cursor: pointer;
            background: none;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="stats-bar">
        <span>Level: <span id="level-ui" style="color:var(--accent-color)">1</span></span>
        <span>Target: <span id="progress-ui">0/10</span></span>
        <span>Score: <span id="score-ui">0</span></span>
    </div>

    <div id="game-wrapper">
        
        <div id="menu-main" class="overlay">
            <h1>SNAKE</h1>
            <button onclick="showScreen('menu-diff')">New Game</button>
            <button onclick="showScreen('menu-settings')">Settings</button>
        </div>

        <div id="menu-diff" class="overlay hidden">
            <h2>Select Speed</h2>
            <button onclick="startGame(130)">Easy</button>
            <button onclick="startGame(90)">Normal</button>
            <button onclick="startGame(60)">Hard</button>
            <button class="secondary" onclick="showScreen('menu-main')">Back</button>
        </div>

        <div id="menu-settings" class="overlay hidden">
            <h2>Customization</h2>
            <div class="settings-grid">
                <div class="settings-row">
                    <label>Snake Color</label>
                    <input type="color" id="color-snake" value="#2ecc71">
                </div>
                <div class="settings-row">
                    <label>Food Color</label>
                    <input type="color" id="color-food" value="#e74c3c">
                </div>
            </div>
            <button onclick="showScreen('menu-main')">Save & Back</button>
        </div>

        <div id="menu-over" class="overlay hidden">
            <h1 style="color: var(--danger-color); font-size: 3rem;">GAME OVER</h1>
            <p id="final-stat" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
            <button onclick="showScreen('menu-main')">Main Menu</button>
        </div>

        <canvas id="gameCanvas" width="600" height="400"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 20;

        // Game State Variables
        let snake = [];
        let food = {x: 0, y: 0};
        
        // Direction & Input Buffering
        let dx = gridSize;
        let dy = 0;
        let nextDx = gridSize;
        let nextDy = 0;

        // Stats
        let score = 0;
        let level = 1;
        let progress = 0; // Apples eaten in current level
        let gameInterval;
        let isPaused = false;

        // UI Management
        function showScreen(id) {
            // Hide all overlays
            document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
            // Show the specific one requested (unless starting game)
            if (id !== 'none') {
                document.getElementById(id).classList.remove('hidden');
            }
        }

        function startGame(speed) {
            resetGame();
            showScreen('none'); // Hide menus
            
            if(gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, speed);
        }

        function resetGame() {
            // Center snake start
            snake = [
                {x: 6 * gridSize, y: 10 * gridSize},
                {x: 5 * gridSize, y: 10 * gridSize},
                {x: 4 * gridSize, y: 10 * gridSize}
            ];
            
            dx = gridSize; dy = 0;
            nextDx = gridSize; nextDy = 0;
            
            score = 0;
            level = 1;
            progress = 0;
            
            spawnFood();
            updateUI();
            draw(); // Initial draw before loop starts
        }

        function spawnFood() {
            food = {
                x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
                y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize
            };
            
            // Check if food spawned on snake body
            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) spawnFood();
            });
        }

        function updateUI() {
            document.getElementById('level-ui').innerText = level;
            document.getElementById('score-ui').innerText = score;
            const target = level * 10;
            document.getElementById('progress-ui').innerText = `${progress} / ${target}`;
        }

        // Main Game Loop
        function gameLoop() {
            if (isPaused) return;

            // Apply buffered input direction
            dx = nextDx;
            dy = nextDy;

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // 1. Check Wall Collision
            if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
                return gameOver();
            }

            // 2. Check Self Collision
            for (let i = 0; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return gameOver();
                }
            }

            snake.unshift(head); // Add new head

            // 3. Check Food Collision
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                progress++;
                
                // Level Up Logic: Target = Level * 10
                if (progress >= level * 10) {
                    level++;
                    progress = 0; 
                    // Note: We keep speed constant within a game session for stability, 
                    // or you could add clearInterval/setInterval here to speed it up.
                }
                
                spawnFood();
                updateUI();
            } else {
                snake.pop(); // Remove tail if no food eaten
            }

            draw();
        }

        function draw() {
            // Clear Canvas
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Food (with glow effect)
            const foodColor = document.getElementById('color-food').value;
            ctx.fillStyle = foodColor;
            ctx.shadowBlur = 15;
            ctx.shadowColor = foodColor;
            
            ctx.beginPath();
            ctx.arc(food.x + gridSize/2, food.y + gridSize/2, gridSize/2 - 2, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.shadowBlur = 0; // Reset shadow for snake

            // Draw Snake (Connected Lines)
            const snakeColor = document.getElementById('color-snake').value;
            ctx.strokeStyle = snakeColor;
            ctx.lineWidth = gridSize - 2; // Slightly smaller than grid for definition
            ctx.lineCap = "round";
            ctx.lineJoin = "round";

            ctx.beginPath();
            // Move to center of head
            ctx.moveTo(snake[0].x + gridSize/2, snake[0].y + gridSize/2);
            
            // Draw line through all body parts
            for (let i = 1; i < snake.length; i++) {
                ctx.lineTo(snake[i].x + gridSize/2, snake[i].y + gridSize/2);
            }
            ctx.stroke();

            // Draw Eyes on Head
            ctx.fillStyle = "#ffffff";
            ctx.beginPath();
            // Offset eyes based on current direction could be added here, 
            // but simple fixed eyes work well for 1-to-1 style
            ctx.arc(snake[0].x + 6, snake[0].y + 6, 2, 0, Math.PI * 2);
            ctx.arc(snake[0].x + 14, snake[0].y + 6, 2, 0, Math.PI * 2);
            ctx.fill();
        }

        function gameOver() {
            clearInterval(gameInterval);
            document.getElementById('final-stat').innerHTML = `Reached <b>Level ${level}</b><br>Score: ${score}`;
            showScreen('menu-over');
        }

        // Input Handling
        window.addEventListener('keydown', e => {
            // Prevent scrolling with arrows
            if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
                e.preventDefault();
            }

            switch(e.key) {
                case 'ArrowUp': 
                    if (dy === 0) { nextDx = 0; nextDy = -gridSize; } 
                    break;
                case 'ArrowDown': 
                    if (dy === 0) { nextDx = 0; nextDy = gridSize; } 
                    break;
                case 'ArrowLeft': 
                    if (dx === 0) { nextDx = -gridSize; nextDy = 0; } 
                    break;
                case 'ArrowRight': 
                    if (dx === 0) { nextDx = gridSize; nextDy = 0; } 
                    break;
            }
        });

        // Initial render
        draw();
    </script>
</body>
</html>
